<!DOCTYPE html>
<html>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
    <body>

        <div ng-app="pm" ng-controller="homeCtrl">
            username<input ng-model="user.username"/>
            <br/>
            password<input type="password" ng-model="user.password"/>
            <button ng-click="save()">save</button>
            <button ng-click="login()">login</button>
            <br/>
            {{successMsg}}
        </div>

        <script>
            angular.module("pm", []);
            angular.module("pm")
                    .controller("homeCtrl", function ($scope, dataService) {
                        $scope.user = {};
                        $scope.save = function () {
                            dataService.saveUser($scope.user)
                                    .then(function (response) {
                                        $scope.successMsg = response.data + "user " + $scope.user.username + " is resgitred!"
                                    });
                        }
                        $scope.login = function () {
                            dataService.login($scope.user.username, $scope.user.password).then(function (data) {
                                console.log(data.token);
                            })


                        }
                    });
            angular.module("pm")
                    .service("dataService", function ($http, $log, $q) {
                        $service = this;


                        $service.saveUser = function (user) {
                            return $http.post("/users?access_token=39ea2121-511b-43cf-ac59-45e28aed7bc8", {
                                username: user.username,
                                password: user.password
                            })
                        }
                        $service.login = function (username, password) {
                            var config = {
                                headers: {
                                    "Authorization": "Basic bXktdHJ1c3RlZC1jbGllbnQ6c2VjcmV0"
                                }
                            }
                            var deferred = $q.defer();
                            $http.post('http://localhost:8081/oauth/token?grant_type=password&username=' + username + '&password=' + password, {}, config)
                                    .then(function (response) {
                                        console.log(response);
                                        deferred.resolve({
                                            token: response.data.access_token
                                        });
                                    });
                            return deferred.promise;
                        }
                    });
        </script>

    </body>
</html>